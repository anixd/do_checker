<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>mirror_checker</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body
  data-regions-url="{{ url_for('routes.api_get_regions') }}"
  data-cities-url="{{ url_for('routes.api_get_cities') }}"
  data-isps-url="{{ url_for('routes.api_get_isps') }}"
  data-events-url="{{ url_for('sse.events', run_id='') }}"
>

  <nav class="tabs">
    <a href="{{ url_for('routes.index') }}" class="active">Checker</a>
    <a href="{{ url_for('routes.catalog') }}" target="_blank" rel="noopener noreferrer">Geo Catalog</a>
    <a href="{{ url_for('routes.settings') }}" target="_blank" rel="noopener noreferrer">Settings</a>
  </nav>

  <h1 class="mb-2">DO Checker</h1>

  <form method="post" action="{{ url_for('routes.launch_run') }}" id="check-form">

    <fieldset>
      <legend>Check Parameters</legend>
      <div class="form-group">
        <label for="urls">URL(s), one per line</label>
        <textarea name="urls" id="urls" placeholder="somesite.com&#10;othersite.org"></textarea>
      </div>
    </fieldset>

    <fieldset>
      <legend>Geo Parameters (Port-mode)</legend>
      <div class="row">
        <div class="form-group">
          <label for="country">Country (required)</label>
          <select name="country" id="country" required>
            <option value="" disabled selected>-- choose --</option>
            {% for c in countries %}
              <option value="{{c.code}}">{{c.code | upper}} â€” {{c.name}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="region">Region</label>
          <select name="region" id="region" disabled> <option value="">(any)</option> </select>
        </div>
        <div class="form-group">
          <label for="city">City</label>
          <select name="city" id="city" disabled> <option value="">(any)</option> </select>
        </div>
        <div class="form-group">
          <label for="isp">ISP</label>
          <select name="isp" id="isp" disabled> <option value="">(any)</option> </select>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Proxy Settings</legend>
      <div class="row">
        <div class="form-group">
          <label for="connection_type">Connection Type</label>
          <input type="text" id="connection_type" name="connection_type" value="wifi" readonly>
        </div>
        <div class="form-group">
          <label for="proxy_type">Protocol</label>
          <select name="proxy_type" id="proxy_type">
            <option value="http" {% if defaults.proxy_type=='http' %}selected{% endif %}>HTTP</option>
            <option value="socks5" {% if defaults.proxy_type=='socks5' %}selected{% endif %}>SOCKS5</option>
          </select>
        </div>
        <div class="form-group">
          <label for="dns_mode">DNS</label>
          <select name="dns_mode" id="dns_mode">
            <option value="proxy" {% if defaults.dns_mode=='proxy' %}selected{% endif %}>via proxy</option>
            <option value="local" {% if defaults.dns_mode=='local' %}selected{% endif %}>local</option>
          </select>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Advanced / Overrides</legend>
      <div class="row">
        <div class="form-group">
          <label for="proxy_host">Proxy Host (Override)</label>
          <input type="text" id="proxy_host" name="proxy_host" placeholder="{{ defaults.soax_host }}">
        </div>
        <div class="form-group">
          <label for="proxy_port">Proxy Port (Override)</label>
          <input type="number" id="proxy_port" name="proxy_port" placeholder="{{ defaults.soax_port_default }}">
        </div>
        <div class="form-group">
          <label for="timeout_sec">Timeout (sec)</label>
          <input name="timeout_sec" id="timeout_sec" type="number" min="5" value="{{defaults.timeout_sec}}"/>
        </div>
        <div class="form-group">
          <label style="visibility: hidden;">_</label>
          <label> <input type="checkbox" name="make_screenshot" {% if defaults.screenshots_enabled %}checked{% endif %}/> Screenshots </label>
        </div>
      </div>
      <div class="form-group">
        <label style="visibility: hidden;">_</label>
        <label> <input type="checkbox" name="debug_mode" {% if request.args.get('debug') %}checked{% endif %}/> <span class="text-danger">Debug Mode</span> </label>
      </div>
      <div class="row" style="display: none;">
      </div>
    </fieldset>

    <div class="row" style="justify-content: space-between; align-items: center;">
       <div>
          <button type="submit" id="run-button">Run checks</button>
          <button type="button" id="clear-logs-button" class="button-secondary ml-2" data-clear-url="{{ url_for('routes.clear_logs') }}">Clear logs</button>
       </div>
    </div>
    <p class="muted">Files will be saved under {{ logs_dir }}</p>
  </form>

  <div id="results-container" class="mt-3">
    </div>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>
